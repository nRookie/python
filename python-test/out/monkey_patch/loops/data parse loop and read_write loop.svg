<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1133px" preserveAspectRatio="none" style="width:1274px;height:1133px;" version="1.1" viewBox="0 0 1274 1133" width="1274px" zoomAndPan="magnify"><defs><filter height="300%" id="f687wgqmji8zv" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f687wgqmji8zv)" height="170.5938" style="stroke: #000000; stroke-width: 2.0;" width="398" x="865" y="104.6094"/><rect fill="#FFFFFF" filter="url(#f687wgqmji8zv)" height="138.2422" style="stroke: #000000; stroke-width: 2.0;" width="378" x="875" y="129.9609"/><rect fill="#FFFFFF" height="46.1875" style="stroke: none; stroke-width: 1.0;" width="378" x="875" y="222.0156"/><rect fill="#FFFFFF" filter="url(#f687wgqmji8zv)" height="738.4063" style="stroke: #000000; stroke-width: 2.0;" width="958" x="140" y="289.2031"/><rect fill="#FFFFFF" filter="url(#f687wgqmji8zv)" height="615" style="stroke: #000000; stroke-width: 2.0;" width="824" x="150" y="405.6094"/><rect fill="#FFFFFF" filter="url(#f687wgqmji8zv)" height="536.4609" style="stroke: #000000; stroke-width: 2.0;" width="804" x="160" y="430.9609"/><rect fill="#FFFFFF" filter="url(#f687wgqmji8zv)" height="443.4063" style="stroke: #000000; stroke-width: 2.0;" width="784" x="170" y="517.0156"/><rect fill="#FFFFFF" filter="url(#f687wgqmji8zv)" height="48.7031" style="stroke: #000000; stroke-width: 2.0;" width="375.5" x="442" y="616.0703"/><rect fill="#FFFFFF" height="214.9453" style="stroke: none; stroke-width: 1.0;" width="784" x="170" y="745.4766"/><rect fill="#FFFFFF" filter="url(#f687wgqmji8zv)" height="185.1094" style="stroke: #000000; stroke-width: 2.0;" width="732" x="180" y="768.3125"/><rect fill="#FFFFFF" filter="url(#f687wgqmji8zv)" height="48.7031" style="stroke: #000000; stroke-width: 2.0;" width="375.5" x="442" y="867.3672"/><rect fill="#FFFFFF" height="46.1875" style="stroke: none; stroke-width: 1.0;" width="824" x="150" y="974.4219"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="27" x2="27" y1="87.6094" y2="1044.6094"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="118" x2="118" y1="87.6094" y2="1044.6094"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="246" x2="246" y1="87.6094" y2="1044.6094"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="340" x2="340" y1="87.6094" y2="1044.6094"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="410" x2="410" y1="87.6094" y2="1044.6094"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="491" x2="491" y1="87.6094" y2="1044.6094"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="747.5" x2="747.5" y1="87.6094" y2="1044.6094"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="949" x2="949" y1="87.6094" y2="1044.6094"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1055" x2="1055" y1="87.6094" y2="1044.6094"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1130" x2="1130" y1="87.6094" y2="1044.6094"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1211" x2="1211" y1="87.6094" y2="1044.6094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="33" x="8" y="84.5332">robot</text><ellipse cx="27.5" cy="13" fill="#FEFECE" filter="url(#f687wgqmji8zv)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M27.5,21 L27.5,48 M14.5,29 L40.5,29 M27.5,48 L14.5,63 M27.5,48 L40.5,63 " fill="none" filter="url(#f687wgqmji8zv)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="33" x="8" y="1058.1426">robot</text><ellipse cx="27.5" cy="1071.2188" fill="#FEFECE" filter="url(#f687wgqmji8zv)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M27.5,1079.2188 L27.5,1106.2188 M14.5,1087.2188 L40.5,1087.2188 M27.5,1106.2188 L14.5,1121.2188 M27.5,1106.2188 L40.5,1121.2188 " fill="none" filter="url(#f687wgqmji8zv)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f687wgqmji8zv)" height="31.6094" style="stroke: #A80036; stroke-width: 1.5;" width="119" x="57" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="105" x="64" y="72.5332">NB_ATKeywords</text><rect fill="#FEFECE" filter="url(#f687wgqmji8zv)" height="31.6094" style="stroke: #A80036; stroke-width: 1.5;" width="119" x="57" y="1043.6094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="105" x="64" y="1065.1426">NB_ATKeywords</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="107" x="190" y="84.5332">response_queue</text><ellipse cx="246.5" cy="54" fill="#FEFECE" filter="url(#f687wgqmji8zv)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="234.5" x2="258.5" y1="68" y2="68"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="107" x="190" y="1058.1426">response_queue</text><ellipse cx="246.5" cy="1077.2188" fill="#FEFECE" filter="url(#f687wgqmji8zv)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="234.5" x2="258.5" y1="1091.2188" y2="1091.2188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="49" x="313" y="84.5332">rxBuffer</text><ellipse cx="340.5" cy="54" fill="#FEFECE" filter="url(#f687wgqmji8zv)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="328.5" x2="352.5" y1="68" y2="68"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="49" x="313" y="1058.1426">rxBuffer</text><ellipse cx="340.5" cy="1077.2188" fill="#FEFECE" filter="url(#f687wgqmji8zv)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="328.5" x2="352.5" y1="1091.2188" y2="1091.2188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="58" x="378" y="84.5332">rspBuffer</text><ellipse cx="410" cy="54" fill="#FEFECE" filter="url(#f687wgqmji8zv)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="398" x2="422" y1="68" y2="68"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="58" x="378" y="1058.1426">rspBuffer</text><ellipse cx="410" cy="1077.2188" fill="#FEFECE" filter="url(#f687wgqmji8zv)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="398" x2="422" y1="1091.2188" y2="1091.2188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="452" y="84.5332">eventBuffer</text><ellipse cx="491.5" cy="54" fill="#FEFECE" filter="url(#f687wgqmji8zv)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="479.5" x2="503.5" y1="68" y2="68"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="452" y="1058.1426">eventBuffer</text><ellipse cx="491.5" cy="1077.2188" fill="#FEFECE" filter="url(#f687wgqmji8zv)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="479.5" x2="503.5" y1="1091.2188" y2="1091.2188"/><rect fill="#FEFECE" filter="url(#f687wgqmji8zv)" height="31.6094" style="stroke: #A80036; stroke-width: 1.5;" width="115" x="688.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="101" x="695.5" y="72.5332">low_level_nb_at</text><rect fill="#FEFECE" filter="url(#f687wgqmji8zv)" height="31.6094" style="stroke: #A80036; stroke-width: 1.5;" width="115" x="688.5" y="1043.6094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="101" x="695.5" y="1065.1426">low_level_nb_at</text><rect fill="#FEFECE" filter="url(#f687wgqmji8zv)" height="31.6094" style="stroke: #A80036; stroke-width: 1.5;" width="124" x="885" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="110" x="892" y="72.5332">low_level_uart_at</text><rect fill="#FEFECE" filter="url(#f687wgqmji8zv)" height="31.6094" style="stroke: #A80036; stroke-width: 1.5;" width="124" x="885" y="1043.6094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="110" x="892" y="1065.1426">low_level_uart_at</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="59" x="1023" y="84.5332">rx_queue</text><ellipse cx="1055.5" cy="54" fill="#FEFECE" filter="url(#f687wgqmji8zv)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1043.5" x2="1067.5" y1="68" y2="68"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="59" x="1023" y="1058.1426">rx_queue</text><ellipse cx="1055.5" cy="1077.2188" fill="#FEFECE" filter="url(#f687wgqmji8zv)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1043.5" x2="1067.5" y1="1091.2188" y2="1091.2188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="58" x="1098" y="84.5332">tx_queue</text><ellipse cx="1130" cy="54" fill="#FEFECE" filter="url(#f687wgqmji8zv)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1118" x2="1142" y1="68" y2="68"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="58" x="1098" y="1058.1426">tx_queue</text><ellipse cx="1130" cy="1077.2188" fill="#FEFECE" filter="url(#f687wgqmji8zv)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1118" x2="1142" y1="1091.2188" y2="1091.2188"/><rect fill="#FEFECE" filter="url(#f687wgqmji8zv)" height="31.6094" style="stroke: #A80036; stroke-width: 1.5;" width="60" x="1179" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="46" x="1186" y="72.5332">module</text><rect fill="#FEFECE" filter="url(#f687wgqmji8zv)" height="31.6094" style="stroke: #A80036; stroke-width: 1.5;" width="60" x="1179" y="1043.6094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="46" x="1186" y="1065.1426">module</text><path d="M865,104.6094 L938,104.6094 L938,112.6094 L928,122.6094 L865,122.6094 L865,104.6094 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="170.5938" style="stroke: #000000; stroke-width: 2.0;" width="398" x="865" y="104.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="880" y="119.1045">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="148" x="953" y="118.0283">[when uart port is opened]</text><path d="M875,129.9609 L936,129.9609 L936,137.9609 L926,147.9609 L875,147.9609 L875,129.9609 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="138.2422" style="stroke: #000000; stroke-width: 2.0;" width="378" x="875" y="129.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="16" x="890" y="144.4561">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="99" x="951" y="143.3799">[uart_write is set]</text><polygon fill="#A80036" points="1199,166.6641,1209,170.6641,1199,174.6641,1203,170.6641" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1130" x2="1205" y1="170.6641" y2="170.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="57" x="1137" y="165.8076">send data</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="949" x2="991" y1="201.0156" y2="201.0156"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="991" x2="991" y1="201.0156" y2="214.0156"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="950" x2="991" y1="214.0156" y2="214.0156"/><polygon fill="#A80036" points="960,210.0156,950,214.0156,960,218.0156,956,214.0156" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="956" y="196.1592">unset uart_write</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="875" x2="1253" y1="223.0156" y2="223.0156"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="290" x="880" y="234.4346">[uart_write is not set and there is data from module]</text><polygon fill="#A80036" points="1066.5,256.2031,1056.5,260.2031,1066.5,264.2031,1062.5,260.2031" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1060.5" x2="1210" y1="260.2031" y2="260.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="1072.5" y="255.3467">recv data</text><path d="M140,289.2031 L213,289.2031 L213,297.2031 L203,307.2031 L140,307.2031 L140,289.2031 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="738.4063" style="stroke: #000000; stroke-width: 2.0;" width="958" x="140" y="289.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="155" y="303.6982">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="148" x="228" y="302.6221">[when uart port is opened]</text><polygon fill="#A80036" points="937,325.9063,947,329.9063,937,333.9063,941,329.9063" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="748" x2="943" y1="329.9063" y2="329.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="67" x="755" y="325.0498">ll_uart_read</text><polygon fill="#A80036" points="1043.5,356.2578,1053.5,360.2578,1043.5,364.2578,1047.5,360.2578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="748" x2="1049.5" y1="360.2578" y2="360.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133" x="755" y="355.4014">get data from rx_queue</text><polygon fill="#A80036" points="759,386.6094,749,390.6094,759,394.6094,755,390.6094" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="753" x2="1054.5" y1="390.6094" y2="390.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62" x="765" y="385.7529">return data</text><path d="M150,405.6094 L211,405.6094 L211,413.6094 L201,423.6094 L150,423.6094 L150,405.6094 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="615" style="stroke: #000000; stroke-width: 2.0;" width="824" x="150" y="405.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="16" x="165" y="420.1045">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="158" x="226" y="419.0283">[wait_response_counter &gt; 0]</text><path d="M160,430.9609 L233,430.9609 L233,438.9609 L223,448.9609 L160,448.9609 L160,430.9609 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="536.4609" style="stroke: #000000; stroke-width: 2.0;" width="804" x="160" y="430.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="175" y="445.4561">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="248" y="444.3799">[length of data &gt; 0]</text><polygon fill="#A80036" points="421,467.6641,411,471.6641,421,475.6641,417,471.6641" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="415" x2="747" y1="471.6641" y2="471.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="314" x="427" y="466.8076">put one bytes of data into rspBuffer and len of data - 1.</text><polygon fill="#A80036" points="736,498.0156,746,502.0156,736,506.0156,740,502.0156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="410" x2="742" y1="502.0156" y2="502.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="229" x="417" y="497.1592">decode the data from rspBuffer into recv</text><path d="M170,517.0156 L231,517.0156 L231,525.0156 L221,535.0156 L170,535.0156 L170,517.0156 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="443.4063" style="stroke: #000000; stroke-width: 2.0;" width="784" x="170" y="517.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="16" x="185" y="531.5107">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="224" x="246" y="530.4346">[recv ends with expected_endswith_str]</text><polygon fill="#A80036" points="257.5,553.7188,247.5,557.7188,257.5,561.7188,253.5,557.7188" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="251.5" x2="747" y1="557.7188" y2="557.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="263.5" y="552.8623">put the recv into response_queue</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="748" x2="790" y1="588.0703" y2="588.0703"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="790" x2="790" y1="588.0703" y2="601.0703"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="749" x2="790" y1="601.0703" y2="601.0703"/><polygon fill="#A80036" points="759,597.0703,749,601.0703,759,605.0703,755,601.0703" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145" x="755" y="583.2139">wait rsp_counter decrase</text><path d="M442,616.0703 L503,616.0703 L503,624.0703 L493,634.0703 L442,634.0703 L442,616.0703 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="48.7031" style="stroke: #000000; stroke-width: 2.0;" width="375.5" x="442" y="616.0703"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="16" x="457" y="630.5654">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="104" x="518" y="629.4893">[length of data != 0]</text><polygon fill="#A80036" points="502.5,652.7734,492.5,656.7734,502.5,660.7734,498.5,656.7734" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="496.5" x2="747" y1="656.7734" y2="656.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="230" x="508.5" y="651.917">put the remaining data into event_buffer.</text><polygon fill="#A80036" points="421,690.125,411,694.125,421,698.125,417,694.125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="415" x2="747" y1="694.125" y2="694.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="188" x="427" y="689.2686">clear the content in the rspBuffer</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="748" x2="790" y1="724.4766" y2="724.4766"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="790" x2="790" y1="724.4766" y2="737.4766"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="749" x2="790" y1="737.4766" y2="737.4766"/><polygon fill="#A80036" points="759,733.4766,749,737.4766,759,741.4766,755,737.4766" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="187" x="755" y="719.6201">clear the expected_endswith_str</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="170" x2="954" y1="746.4766" y2="746.4766"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="243" x="175" y="757.8955">[parse recv according to RESPONSE_REGEXP]</text><path d="M180,768.3125 L241,768.3125 L241,776.3125 L231,786.3125 L180,786.3125 L180,768.3125 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="185.1094" style="stroke: #000000; stroke-width: 2.0;" width="732" x="180" y="768.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="16" x="195" y="782.8076">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="195" x="256" y="781.7314">[recv match the RESPONSE_REGEXP]</text><polygon fill="#A80036" points="257.5,805.0156,247.5,809.0156,257.5,813.0156,253.5,809.0156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="251.5" x2="747" y1="809.0156" y2="809.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="195" x="263.5" y="804.1592">put the recv into response_queue.</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="748" x2="790" y1="839.3672" y2="839.3672"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="790" x2="790" y1="839.3672" y2="852.3672"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="749" x2="790" y1="852.3672" y2="852.3672"/><polygon fill="#A80036" points="759,848.3672,749,852.3672,759,856.3672,755,852.3672" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145" x="755" y="834.5107">wait rsp_counter decrase</text><path d="M442,867.3672 L503,867.3672 L503,875.3672 L493,885.3672 L442,885.3672 L442,867.3672 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="48.7031" style="stroke: #000000; stroke-width: 2.0;" width="375.5" x="442" y="867.3672"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="16" x="457" y="881.8623">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="104" x="518" y="880.7861">[length of data != 0]</text><polygon fill="#A80036" points="502.5,904.0703,492.5,908.0703,502.5,912.0703,498.5,908.0703" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="496.5" x2="747" y1="908.0703" y2="908.0703"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="230" x="508.5" y="903.2139">put the remaining data into event_buffer.</text><polygon fill="#A80036" points="421,941.4219,411,945.4219,421,949.4219,417,945.4219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="415" x2="747" y1="945.4219" y2="945.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="188" x="427" y="940.5654">clear the content in the rspBuffer</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="150" x2="974" y1="975.4219" y2="975.4219"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="164" x="155" y="986.8408">[wait_response_counter == 0]</text><polygon fill="#A80036" points="502.5,1008.6094,492.5,1012.6094,502.5,1016.6094,498.5,1012.6094" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="496.5" x2="747" y1="1012.6094" y2="1012.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="508.5" y="1007.7529">put data into the event_Buffer</text><!--MD5=[d3d3151b96fe66063a5444b59cfef2a5]
@startuml data parse loop and read_write loop

actor robot as r

participant NB_ATKeywords as na


entity response_queue as rspq

entity rxBuffer as rxb
entity rspBuffer as rspb
entity eventBuffer as eb

participant low_level_nb_at as llna

participant low_level_uart_at as llua  

entity rx_queue as rxq
entity tx_queue as txq

participant module as m


loop when uart port is opened 
    alt uart_write is set
        txq -> m: send data
        llua -> llua: unset uart_write
    else uart_write is not set and there is data from module 
        m -> rxq: recv data 
    end
end 

loop when uart port is opened
    llna -> llua: ll_uart_read
    llna -> rxq: get data from rx_queue 
    rxq -> llna: return data

    alt wait_response_counter > 0

        loop length of data > 0
            llna -> rspb: put one bytes of data into rspBuffer and len of data - 1.
            rspb -> llna: decode the data from rspBuffer into recv
        
            alt  recv ends with expected_endswith_str
                llna -> rspq: put the recv into response_queue
                llna -> llna: wait rsp_counter decrase
                alt length of data != 0
                    llna -> eb: put the remaining data into event_buffer.
                end
                llna -> rspb: clear the content in the rspBuffer
                llna -> llna: clear the expected_endswith_str
            else parse recv according to RESPONSE_REGEXP

                alt recv match the RESPONSE_REGEXP 
                    llna -> rspq: put the recv into response_queue.
                    llna -> llna: wait rsp_counter decrase

                    alt length of data != 0
                    llna -> eb: put the remaining data into event_buffer.
                    end

                    llna -> rspb: clear the content in the rspBuffer
                end 

            end 
        end
    
    else wait_response_counter == 0
        llna -> eb: put data into the event_Buffer
    end
end
@enduml

PlantUML version 1.2020.10(Sun May 17 17:35:57 CST 2020)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) Client VM
Java Version: 1.8.0_221-b11
Operating System: Windows 10
Default Encoding: MS932
Language: zh
Country: CN
--></g></svg>